<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Turbulence - Reaction Game</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
<style>
  body {
    margin: 0;
    background: radial-gradient(ellipse at 60% 90%, #232742 0%, #0e1124 90%);
    color: #fffbe3;
    font-family: 'Press Start 2P', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 12px;
    user-select: none;
    overflow: hidden;
  }
  #title {
    font-size: 24px;
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 2px;
    color: #ffe764;
    text-shadow: 0 2px 20px #ffe76455, 0 1px 0 #353a5c, 0 0 8px #ffe764b5;
    transition: color 0.4s;
  }
  canvas {
    border: 4px solid #ffe764;
    background: linear-gradient(180deg, #181a2b 70%, #232742 100%);
    image-rendering: pixelated;
    width: 420px;
    height: 560px;
    max-width: 96vw;
    max-height: 78vh;
    display: block;
    box-shadow: 0 0 18px #ffe76455, 0 0 60px #23274288;
    border-radius: 18px;
    margin-bottom: 14px;
    margin-top: 2px;
    transition: border-color 0.3s;
  }
  #instructions {
    font-size: 14px;
    margin-top: 10px;
    margin-bottom: 14px;
    text-align: center;
    color: #ffe764;
    background: rgba(20, 20, 40, 0.5);
    border-radius: 9px;
    padding: 8px 10px 7px 10px;
    border: 1.5px solid #ffe76455;
    display: inline-block;
    box-shadow: 0 0 6px #ffe7641c;
    letter-spacing: 0.01em;
  }
  #startButton {
    font-family: 'Press Start 2P', monospace;
    font-size: 16px;
    background: #232742;
    color: #ffe764;
    border: 3px solid #ffe764;
    border-radius: 9px;
    padding: 14px 32px;
    cursor: pointer;
    letter-spacing: 0.09em;
    user-select: none;
    margin-top: 10px;
    margin-bottom: 2px;
    box-shadow: 0 2px 0 0 #353a5c, 0 0 12px #ffe76470 inset;
    transition: background 0.16s, color 0.13s, border-color 0.13s, transform 0.07s;
  }
  #startButton:hover {
    background: #ffe764;
    color: #232742;
    border-color: #fffbe3;
    transform: scale(1.04) translateY(-1px);
    box-shadow: 0 0 20px #ffe764ad, 0 3px 0 0 #353a5c;
  }
  .scoreDisplay {
    font-size: 13px;
    color: #fffbe3;
    margin-bottom: 6px;
    text-align: center;
    letter-spacing: 0.06em;
    text-shadow: 0 1px 0 #353a5c, 0 0 7px #ffe7641c;
  }
  @media (max-width: 600px) {
    #title { font-size: 16px; }
    #instructions { font-size: 10px; padding: 6px 5px; }
    #startButton { font-size: 10px; padding: 9px 17px; }
    canvas { width: 96vw; height: 60vw; min-height: 240px; min-width: 160px; }
  }
</style>
</head>
<body>
  <div id="title">üåä TURBULENCE...</div>
  <div class="scoreDisplay" id="scoreDisplay" style="display:none;"></div>
  <canvas id="gameCanvas" width="420" height="560"></canvas>
  <div id="instructions">Use ‚óÄÔ∏è and ‚ñ∂Ô∏è arrow keys<br>to dodge falling red blocks</div>
  <button id="startButton">START</button>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const startButton = document.getElementById("startButton");
  const title = document.getElementById("title");
  const instructions = document.getElementById("instructions");
  const scoreDisplay = document.getElementById("scoreDisplay");

  const CANVAS_WIDTH = canvas.width;
  const CANVAS_HEIGHT = canvas.height;
  const PLAYER_SIZE = 36;
  const BLOCK_SIZE = 36;
  const PLAYER_COLOR = "#fffbe3";
  const BLOCK_COLOR = "#ff355b";
  const SHADOW_COLOR = "#ffe76499";

  let player = { x: Math.floor(CANVAS_WIDTH / 2 - PLAYER_SIZE / 2), y: CANVAS_HEIGHT - PLAYER_SIZE - 18, w: PLAYER_SIZE, h: PLAYER_SIZE };
  let blocks = [];
  let keys = {};
  let running = false;
  let elapsedTime = 0;
  let difficultyLevel = 0;
  let blockSpeed = 3;
  let spawnRate = 0.012;
  let score = 0;
  let impossibleStarted = false;

  function drawPixelRect(x, y, w, h, color) {
    ctx.save();
    ctx.shadowColor = SHADOW_COLOR;
    ctx.shadowBlur = 8;
    ctx.fillStyle = color;
    ctx.fillRect(x, y, w, h);
    ctx.restore();
  }

  function draw() {
    ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

    // Draw player
    drawPixelRect(player.x, player.y, player.w, player.h, PLAYER_COLOR);

    // Draw blocks
    blocks.forEach(b => drawPixelRect(b.x, b.y, b.w, b.h, BLOCK_COLOR));
  }

  function update(deltaTime) {
    // Player movement
    if (keys["ArrowLeft"] && player.x > 0) player.x -= 7;
    if (keys["ArrowRight"] && player.x + player.w < CANVAS_WIDTH) player.x += 7;

    // Clamp player inside canvas
    player.x = Math.max(0, Math.min(player.x, CANVAS_WIDTH - player.w));

    // Move blocks
    blocks.forEach(b => b.y += blockSpeed);

    // Collision detection
    if (blocks.some(b =>
      b.y + b.h > player.y &&
      b.x < player.x + player.w &&
      b.x + b.w > player.x &&
      b.y < player.y + player.h
    )) {
      endGame();
      return;
    }

    // Remove offscreen blocks
    blocks = blocks.filter(b => b.y < CANVAS_HEIGHT);

    // Spawn blocks according to difficulty
    if (difficultyLevel < 3) {
      if (Math.random() < spawnRate) {
        blocks.push({
          x: Math.floor(Math.random() * (CANVAS_WIDTH - BLOCK_SIZE)),
          y: -BLOCK_SIZE,
          w: BLOCK_SIZE,
          h: BLOCK_SIZE
        });
      }
    } else {
      // Impossible: fill the whole screen with a wall the player can't dodge
      // This guarantees the player will always lose in this phase
      if (!impossibleStarted) {
        impossibleStarted = true;
        // Spawn a first wall immediately
        blocks.push({ x: 0, y: -BLOCK_SIZE, w: CANVAS_WIDTH, h: BLOCK_SIZE });
      }
      // Drop a new wall every ~0.5 second, fast enough that the player cannot escape
      if (blocks.length === 0 || blocks[blocks.length - 1].y > BLOCK_SIZE * 0.7) {
        blocks.push({ x: 0, y: -BLOCK_SIZE, w: CANVAS_WIDTH, h: BLOCK_SIZE });
      }
    }
  }

  let lastTime = null;
  function gameTick(timestamp) {
    if (!lastTime) lastTime = timestamp;
    const deltaTime = timestamp - lastTime;
    lastTime = timestamp;

    elapsedTime += deltaTime;
    score = Math.floor(elapsedTime / 100);

    // Difficulty scaling
    if (elapsedTime > 13000) {
      difficultyLevel = 3;
      title.textContent = "üåä IMPOSSIBLE TURBULENCE...";
      spawnRate = 0;
      blockSpeed = 8.5;
    } else if (elapsedTime > 9000) {
      difficultyLevel = 2;
      title.textContent = "üåä Turbulence intensifies...";
      spawnRate = 0.07;
      blockSpeed = 5.4;
    } else if (elapsedTime > 5000) {
      difficultyLevel = 1;
      title.textContent = "üåä Turbulence rising...";
      spawnRate = 0.035;
      blockSpeed = 4.2;
    }

    update(deltaTime);
    draw();

    scoreDisplay.textContent = "SCORE: " + score;
    scoreDisplay.style.display = running ? "block" : "none";

    if (running) {
      requestAnimationFrame(gameTick);
    }
  }

  function startGame() {
    player.x = Math.floor(CANVAS_WIDTH / 2 - PLAYER_SIZE / 2);
    player.y = CANVAS_HEIGHT - PLAYER_SIZE - 18;
    blocks = [];
    elapsedTime = 0;
    difficultyLevel = 0;
    spawnRate = 0.012;
    blockSpeed = 3;
    score = 0;
    impossibleStarted = false;
    title.textContent = "üåä TURBULENCE...";
    instructions.style.display = "block";
    startButton.style.display = "none";
    scoreDisplay.style.display = "block";
    running = true;
    lastTime = null;
    requestAnimationFrame(gameTick);
  }

  function endGame() {
    running = false;
    title.innerHTML = "‚òÅÔ∏è You got hit...<br>But you made it through.";
    instructions.style.display = "none";
    startButton.style.display = "none";
    scoreDisplay.style.display = "block";
    setTimeout(() => {
      window.top.location.href = "https://frdffsdx.carrd.co/#turbulencecomplete";
    }, 2000);
  }

  window.addEventListener("keydown", e => keys[e.key] = true);
  window.addEventListener("keyup", e => keys[e.key] = false);
  startButton.onclick = startGame;
</script>
</body>
</html>
